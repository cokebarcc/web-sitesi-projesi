import{b as F}from"./index-Dk0krrwH.js";const j={start:480,end:720},W={start:780,end:1020},v=30;function H(f){if(!f)return 0;const l=f.split(":");if(l.length<2)return 0;const h=parseInt(l[0],10),S=parseInt(l[1],10);return isNaN(h)||isNaN(S)?0:h*60+S}function _(f,l,h,S){const p=Math.max(f,h),M=Math.min(l,S);return Math.max(0,M-p)}function B(f,l){const h=f.SheetNames[0],S=f.Sheets[h],p=F.sheet_to_json(S,{header:1,raw:!1,dateNF:"dd.mm.yyyy"});console.log("ðŸ“Š [EXCEL-PARSER] Sheet name:",h),console.log("ðŸ“Š [EXCEL-PARSER] Ä°lk 5 satÄ±r:",p.slice(0,5)),p.slice(0,10).forEach((e,n)=>{console.log(`ðŸ“Š [EXCEL-PARSER] SatÄ±r ${n}:`,e)});const M=e=>e?String(e).toLocaleLowerCase("tr-TR").trim().replace(/ÅŸ/g,"s").replace(/Ä±/g,"i").replace(/ÄŸ/g,"g").replace(/Ã¼/g,"u").replace(/Ã¶/g,"o").replace(/Ã§/g,"c").replace(/\s+/g,"").replace(/dr\.|uzm\.|op\.|doc\.|prof\.|dt\.|ecz\.|yt\.|doÃ§\./g,""):"";let c=[],N=[],D=!1;for(const e of p)if(!(!e||e.length===0)){if(!D){e.some(o=>{const i=String(o||"").toLocaleLowerCase("tr-TR");return i.includes("branÅŸ")||i.includes("brans")||i.includes("klinik")||i.includes("hekim")})&&(c=e,D=!0,console.log("âœ… [EXCEL-PARSER] Header satÄ±rÄ± bulundu:",c));continue}N.push(e)}if(c.length===0)return console.error('âŒ [EXCEL-PARSER] Excel header bulunamadÄ±. HiÃ§bir satÄ±rda "branÅŸ" iÃ§eren kolon yok!'),console.error("âŒ [EXCEL-PARSER] Ä°lk 10 satÄ±r:",p.slice(0,10)),{label:l,timestamp:Date.now(),physicianSummaries:[],rawScheduleData:[],physicians:{}};const C=c.findIndex(e=>{const n=String(e||"").toLocaleLowerCase("tr-TR");return n.includes("branÅŸ")||n.includes("brans")||n.includes("klinik")}),b=c.findIndex(e=>{const n=String(e||"").toLocaleLowerCase("tr-TR");return n.includes("hekim")||n.includes("doktor")}),w=c.findIndex(e=>{const n=String(e||"").toLocaleLowerCase("tr-TR");return n.includes("tarih")&&n.includes("aksiyon")}),I=c.findIndex(e=>{const n=String(e||"").toLocaleLowerCase("tr-TR");return n.includes("baslangic")||n.includes("baÅŸlangÄ±Ã§")}),x=c.findIndex(e=>{const n=String(e||"").toLocaleLowerCase("tr-TR");return n.includes("bitis")||n.includes("bitiÅŸ")}),P=c.findIndex(e=>{const n=String(e||"").toLocaleLowerCase("tr-TR");return n.includes("aksiyon")&&!n.includes("tarih")&&!n.includes("baslangic")&&!n.includes("baÅŸlangÄ±Ã§")&&!n.includes("bitis")&&!n.includes("bitiÅŸ")}),A=c.findIndex(e=>{const n=String(e||"").toLocaleLowerCase("tr-TR");return n.includes("kapasite")||n.includes("randevu")});if(C===-1||b===-1||P===-1||A===-1||w===-1||I===-1||x===-1)return console.error("âŒ [EXCEL-PARSER] Excel kolonlarÄ± bulunamadÄ±:",{branchIndex:C,nameIndex:b,dateIndex:w,startTimeIndex:I,endTimeIndex:x,actionIndex:P,capacityIndex:A}),console.error("âŒ [EXCEL-PARSER] Headers:",c),{label:l,timestamp:Date.now(),physicianSummaries:[],rawScheduleData:[],physicians:{}};console.log("âœ… [EXCEL-PARSER] Kolon indexleri:",{branchIndex:C,nameIndex:b,dateIndex:w,startTimeIndex:I,endTimeIndex:x,actionIndex:P,capacityIndex:A});const k=[],a={},O={},X={};for(const e of N){const n=String(e[C]||"").trim(),o=String(e[b]||"").trim(),i=String(e[P]||"").trim().toLocaleUpperCase("tr-TR"),r=String(e[w]||"").trim(),E=String(e[I]||"").trim(),g=String(e[x]||"").trim(),d=e[A];if(N.indexOf(e)===0&&console.log("ðŸ” [EXCEL-PARSER] Ä°lk satÄ±r verisi:",{branch:n,physicianName:o,action:i,startDate:r,startTime:E,endTime:g,capacity:d}),!o||!n||!i||!r)continue;const R=typeof d=="number"?d:parseFloat(String(d||"0").replace(",","."))||0,t=M(o);X[t]=n,O[t]=(O[t]||0)+R;const u=H(E),y=H(g);a[t]||(a[t]={}),a[t][r]||(a[t][r]={AM:{},PM:{}});const L=_(u,y,j.start,j.end);L>0&&(a[t][r].AM[i]||(a[t][r].AM[i]={mins:0,firstStart:1/0}),a[t][r].AM[i].mins+=L,a[t][r].AM[i].firstStart=Math.min(a[t][r].AM[i].firstStart,u));const m=_(u,y,W.start,W.end);m>0&&(a[t][r].PM[i]||(a[t][r].PM[i]={mins:0,firstStart:1/0}),a[t][r].PM[i].mins+=m,a[t][r].PM[i].firstStart=Math.min(a[t][r].PM[i].firstStart,u)),k.push({branch:n,physicianName:o,action:i,capacity:R,startDate:r,startTime:E,endTime:g})}const T={};Object.entries(a).forEach(([e,n])=>{var r;const o={};Object.entries(n).forEach(([E,g])=>{let d="",R=-1,t=1/0;Object.entries(g.AM).forEach(([m,s])=>{s.mins>=v&&(s.mins>R?(R=s.mins,d=m,t=s.firstStart):s.mins===R&&s.firstStart<t&&(d=m,t=s.firstStart))});let u="",y=-1,L=1/0;Object.entries(g.PM).forEach(([m,s])=>{s.mins>=v&&(s.mins>y?(y=s.mins,u=m,L=s.firstStart):s.mins===y&&s.firstStart<L&&(u=m,L=s.firstStart))}),d&&(o[d]=(o[d]||0)+.5),u&&(o[u]=(o[u]||0)+.5)});const i=((r=k.find(E=>M(E.physicianName)===e))==null?void 0:r.physicianName)||"";T[e]={name:i,branch:X[e]||"",totalCapacity:O[e]||0,totalWorkDays:Object.keys(n).length,actionDays:o,rawRows:[]}});const q=Object.values(T);return console.log("âœ… [EXCEL-PARSER] Parse tamamlandÄ±:",{label:l,physicianCount:Object.keys(T).length,totalRows:k.length}),{label:l,timestamp:Date.now(),physicianSummaries:q,rawScheduleData:k,physicians:T}}export{B as parseExcelToScheduleVersion};
